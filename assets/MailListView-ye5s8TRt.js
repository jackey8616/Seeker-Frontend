import{d as T,u as N,c as q,w as t,r as s,a,b as i,t as _,e as p,f as E,g as R,h as F,o as $,_ as I,i as O,j as v,k as S,l as G}from"./index-CJm6Rrhr.js";const J={class:"mb-4"},K={class:"mb-4"},Q={key:0,class:"mail-content"},W=["src"],X=T({__name:"MailDetailDialog",props:{modelValue:{type:Boolean},mail:{}},emits:["update:modelValue"],setup(H,{emit:L}){const B=N(),P=L;function h(n){const o=new Blob([n],{type:"text/html"});return URL.createObjectURL(o)}function k(){P("update:modelValue",!1)}return(n,o)=>{const w=s("v-icon"),c=s("v-btn"),y=s("v-card-title"),M=s("v-card-text"),U=s("v-card"),j=s("v-dialog");return $(),q(j,{"model-value":n.modelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>P("update:modelValue",m)),"max-width":"800px",persistent:""},{default:t(()=>[a(U,null,{default:t(()=>[a(y,{class:"d-flex justify-space-between align-center"},{default:t(()=>{var m;return[i("span",null,_((m=n.mail)==null?void 0:m.title),1),a(c,{icon:"",onClick:k},{default:t(()=>[a(w,null,{default:t(()=>o[1]||(o[1]=[p("mdi-close")])),_:1})]),_:1})]}),_:1}),a(M,null,{default:t(()=>{var m,C,b,A;return[i("div",J,[o[2]||(o[2]=i("strong",null,"From:",-1)),p(" "+_((m=n.mail)==null?void 0:m.sender),1)]),i("div",K,[o[3]||(o[3]=i("strong",null,"Date:",-1)),p(" "+_(F(B).format((C=n.mail)==null?void 0:C.date,"keyboardDateTime24h")),1)]),(A=(b=n.mail)==null?void 0:b.detailMail)!=null&&A.extracted_data?($(),E("div",Q,[i("iframe",{src:h(n.mail.detailMail.extracted_data),width:"100%",height:"500px",frameborder:"0"},null,8,W)])):R("",!0)]}),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Y=I(X,[["__scopeId","data-v-e080e1c8"]]),Z={class:"mail"},ee={class:"d-flex gap-2"},te=["src"],ae={class:"d-flex align-center justify-space-between pa-4"},oe={class:"d-flex align-center gap-2"},le={class:"text-caption"},ne={class:"text-caption"},se={class:"d-flex align-center gap-1"},re=T({__name:"MailListView",setup(H){const L=N(),{axios:B}=O(),P=[{title:"Action",key:"action",sortable:!1},{title:"Sender",key:"sender",sortable:!1},{title:"Title",key:"title",sortable:!1},{title:"Date",key:"date",sortable:!1}],h=v([]),k=v(null),n=v(0),o=v(1),w=v(!1),c=v(null),y=v(10),M=v(!1),U=v(null);async function j(r){var e;try{return(await B.value.get(`/mails/${r}`,{signal:(e=c.value)==null?void 0:e.signal})).data.data.mail}catch(d){if(d.name==="AbortError")return console.log("Request was aborted"),null;throw d}}function m(r){const e=new Blob([r],{type:"text/html"});return URL.createObjectURL(e)}async function C(r=1){var e,d;w.value=!0;try{const f=r===1?{}:{next_page_token:k.value},x=await B.value.post("/mails/list",f,{signal:(e=c.value)==null?void 0:e.signal}),{data:V}=x.data;if(h.value=V.mail_infos,k.value=V.next_page_token,n.value=V.total_count,o.value=r,!((d=c.value)!=null&&d.signal.aborted)){const z=h.value.map(g=>j(g.id).then(u=>{var l;u&&!((l=c.value)!=null&&l.signal.aborted)&&(g.sender=u.sender,g.title=u.title,g.date=u.date,g.detailMail=u)}).catch(u=>{u.name!=="AbortError"&&console.error(`Download mail id ${g.id} cause error`,u)}));await Promise.all(z)}}catch(f){if(f.name==="AbortError"){console.log("List request was aborted");return}console.error("Error fetching mail list:",f)}finally{w.value=!1}}function b(r){C(r)}function A(r){U.value=r,M.value=!0}return S(()=>{c.value=new AbortController,C()}),G(()=>{c.value&&(c.value.abort(),c.value=null)}),(r,e)=>{const d=s("v-icon"),f=s("v-tooltip"),x=s("v-btn"),V=s("router-link"),z=s("v-chip"),g=s("v-divider"),u=s("v-data-table-server");return $(),E("div",Z,[a(u,{headers:P,items:h.value,loading:w.value,"items-length":n.value,page:o.value,"items-per-page":y.value,"onUpdate:page":b,"hide-default-footer":"",hover:""},{"item.action":t(({item:l})=>[i("div",ee,[a(x,{icon:"",size:"x-small",onClick:D=>A(l)},{default:t(()=>[a(d,{icon:"mdi-email-open"}),a(f,{activator:"parent",location:"bottom"},{default:t(()=>e[3]||(e[3]=[p("View Mail")])),_:1})]),_:2},1032,["onClick"]),l.detailMail!==void 0?($(),q(V,{key:0,to:{name:"mail-fitting",params:{thread_id:l.detailMail.id}},custom:""},{default:t(({navigate:D})=>[a(x,{icon:"",size:"x-small",onClick:D},{default:t(()=>[a(d,{icon:"mdi-brain"}),a(f,{activator:"parent",location:"bottom"},{default:t(()=>e[4]||(e[4]=[p("Fitting By AI")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["to"])):R("",!0)])]),"item.date":t(({item:l})=>[a(z,{size:"x-small"},{default:t(()=>[p(_(F(L).format(l.date,"keyboardDateTime24h"))+" ",1),a(f,{activator:"parent",location:"bottom"},{default:t(()=>[p(_(l.date),1)]),_:2},1024)]),_:2},1024)]),"expanded-row":t(({item:l})=>{var D;return[(D=l.detailMail)!=null&&D.extracted_data?($(),E("iframe",{key:0,src:m(l.detailMail.extracted_data),width:"100%"},null,8,te)):R("",!0)]}),bottom:t(()=>[i("div",ae,[i("div",oe,[i("div",le,_((o.value-1)*y.value+1)+"-"+_(Math.min(o.value*y.value,n.value))+" of "+_(n.value),1),a(g,{vertical:"",class:"mx-2"}),i("div",ne," Page "+_(o.value),1)]),i("div",se,[a(x,{icon:"",size:"small",variant:"text",disabled:o.value===1,onClick:e[0]||(e[0]=l=>b(o.value-1))},{default:t(()=>[a(d,null,{default:t(()=>e[5]||(e[5]=[p("mdi-chevron-left")])),_:1})]),_:1},8,["disabled"]),a(x,{icon:"",size:"small",variant:"text",disabled:!k.value,onClick:e[1]||(e[1]=l=>b(o.value+1))},{default:t(()=>[a(d,null,{default:t(()=>e[6]||(e[6]=[p("mdi-chevron-right")])),_:1})]),_:1},8,["disabled"])])])]),_:1},8,["items","loading","items-length","page","items-per-page"]),a(Y,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=l=>M.value=l),mail:U.value},null,8,["modelValue","mail"])])}}});export{re as default};
