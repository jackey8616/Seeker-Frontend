import{d as E,u as T,a as B,r as d,o as L,b as V,c as v,e as m,f as l,w as s,g as i,h as f,i as _,t as b,j as N,k as P}from"./index-NXAnzxZO.js";const R={class:"mail"},U=["src"],q=E({__name:"MailListView",setup($){const h=T(),{axios:p}=B(),x=d([{text:"Action",value:"action"},{text:"Sender",value:"sender"},{text:"Title",value:"title"},{text:"Date",value:"date"}]),u=d([]),w=d(null),c=d(null);async function g(t){var e;try{return(await p.value.get(`/mails/${t}`,{signal:(e=c.value)==null?void 0:e.signal})).data.data.mail}catch(r){if(r.name==="AbortError")return console.log("Request was aborted"),null;throw r}}function k(t){const e=new Blob([t],{type:"text/html"});return URL.createObjectURL(e)}return L(async()=>{c.value=new AbortController;try{const t=await p.value.get("/mails/list",{signal:c.value.signal}),{data:e}=t.data;u.value=e.mail_infos,w.value=e.next_page_token;const r=u.value.map(o=>g(o.id).then(a=>{a&&(o.sender=a.sender,o.title=a.title,o.date=a.date,o.detailMail=a)}).catch(a=>{console.error(`Download mail id ${o.id} cause error`,a)}));await Promise.all(r)}catch(t){if(t.name==="AbortError"){console.log("List request was aborted");return}console.error("Error fetching mail list:",t)}}),V(()=>{c.value&&c.value.abort()}),(t,e)=>{const r=i("v-icon"),o=i("v-tooltip"),a=i("v-btn"),y=i("router-link"),C=i("v-chip"),D=i("EasyDataTable");return m(),v("div",R,[l(D,{style:{width:"100%"},headers:x.value,items:u.value},{"item-action":s(({detailMail:n})=>[n!==void 0?(m(),P(y,{key:0,to:{name:"mail-fitting",params:{thread_id:n.id}},custom:""},{default:s(({navigate:A})=>[l(a,{icon:"",size:"x-small",onClick:A},{default:s(()=>[l(r,{icon:"$ai"}),l(o,{activator:"parent",location:"bottom"},{default:s(()=>e[0]||(e[0]=[_("Fitting By AI")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["to"])):f("",!0)]),"item-date":s(({date:n})=>[l(C,{size:"x-small"},{default:s(()=>[_(b(N(h).format(n,"keyboardDateTime24h"))+" ",1),l(o,{activator:"parent",location:"bottom"},{default:s(()=>[_(b(n),1)]),_:2},1024)]),_:2},1024)]),expand:s(({detailMail:n})=>[n.extracted_data?(m(),v("iframe",{key:0,src:k(n.extracted_data),width:"100%"},null,8,U)):f("",!0)]),_:1},8,["headers","items"])])}}});export{q as default};
